### go并发编程

#### 一些基本概念

进程：指在系统中正在运行的一个应用程序；程序一旦运行就是进程；进程——资源分配的最小单位。

线程：系统分配处理器时间资源的基本单元，或者说进程之内独立执行的一个单元执行流。线程——程序执行的最小单位。

并行(parallel)：指在同一时刻，有多条指令在多个处理器上同时执行。所以无论从微观还是从宏观来看，二者都是一起执行的。

![img](https://upload-images.jianshu.io/upload_images/7557373-72912ea8e89c4007.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/313/format/webp)

并发(concurrency)：指在同一时刻只能有一条指令执行，但多个进程指令被快速的轮换执行，使得在宏观上具有多个进程同时执行的效果，但在微观上并不是同时执行的，只是把时间分成若干段，使多个进程快速交替的执行。

![img](https://upload-images.jianshu.io/upload_images/7557373-da64ffd6d1effaac.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/295/format/webp)

Go主线程：一个Go线程上，可以起多个协程，可以理解为协程是轻量级的线程，可以把主线程理解为一个main()函数.

Go协程的特点:
- 有独立的栈空间
- 共享程序堆空间
- 调度有用户控制
- 轻量级

#### 案例演示

```go
func test() {
	for i := 0; i < 5; i++ {
		fmt.Println("Hello,World")
		//time.Sleep(time.Second)
	}
}

func main() {
	go test()
	for i := 0; i < 5; i++ {
		fmt.Println("Golang!!")
		//time.Sleep(time.Second)
	}
}
```

```
Golang!!
Golang!!
Golang!!
Golang!!
Golang!!
```

test()函数并没有执行,函数就推出了,因为**当主线程即main()函数执行完成后,程序就退出了,无论协程是否执行完毕**.

```go
func test() {
	for i := 0; i < 5; i++ {
		fmt.Println("Hello,World")
		time.Sleep(time.Second)
	}
}

func main() {
	go test()
	for i := 0; i < 5; i++ {
		fmt.Println("Golang!!")
		time.Sleep(time.Second)
	}
}
```

```
Golang!!
Hello,World
Golang!!
Hello,World
Hello,World
Golang!!
Golang!!
Hello,World
Hello,World
Golang!!
```

#### MPG模型

M 代表着一个内核线程，也可以称为一个工作线程。goroutine就是跑在M之上的
P 代表着(Processor)处理器 它的主要用途就是用来执行goroutine的，一个P代表执行一个Go代码片段的基础（可以理解为上下文环境），所以它也维护了一个可运行的goroutine队列，和自由的goroutine队列，里面存储了所有需要它来执行的goroutine。
G 代表着goroutine 实际的数据结构(就是你封装的那个方法)，并维护者goroutine 需要的栈、程序计数器以及它所在的M等信息。

![img](https://img-blog.csdnimg.cn/20190417093416434.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjUyMjk4NQ==,size_16,color_FFFFFF,t_70)